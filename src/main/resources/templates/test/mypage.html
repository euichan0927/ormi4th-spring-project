<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>BoardList</title>
    <link rel="stylesheet" th:href="@{/css/mypageCSS.css}" />

</head>
<body>
<div class="header">
    <h2>마이페이지</h2>

    <div>
        <label>이메일: </label><span th:text="${user.email}"></span>
    </div>
    <div>
        <label>닉네임: </label><span th:text="${user.nickname}"></span>
    </div>
    <!-- 사용자 정보 수정 버튼 -->
    <button class="ui-button" th:onclick="|location.href='@{/mypage/update/{userId}(userId=${user.id})}'|">정보 수정</button>
    <!-- 계정 삭제 처리 -->
    <form th:action="@{/mypage/{userId}(userId=${user.id})}" method="post">
        <input type="hidden" name="_method" value="delete" />
        <button type="submit">계정 삭제</button>
    </form>
    <button class="ui-button" th:if="${user.role eq 'admin'}" th:onclick="|location.href='/mypage/admin'|">관리자페이지</button>
    <hr>
    <!-- 게시글 페이징 -->
    <h3>내가 작성한 게시글</h3>
    <table>
        <thead>
        <tr>
            <th>번호</th>
            <th>제목</th>
            <th>생성 일시</th>
        </tr>
        </thead>
        <tbody>
        <!-- 게시글 행 반복 -->
        <tr th:each="board : ${boardPage.content}">
            <td th:text="${board.id}"></td>
            <td>
                <a th:href="@{/boards/{id}(id=${board.id})}" th:text="${board.title}"></a>
            </td>
            <td th:text="${#dates.format(board.createdAt, 'yyyy-MM-dd HH:mm:ss')}"></td>
        </tr>
        </tbody>
    </table>

    <!-- 게시글 페이징 처리 -->
    <div th:if="${boardPage.totalPages > 0}">
        <ul class="pagination">
            <li class="page-item" th:classappend="${not boardPage.hasPrevious()} ? 'disabled'">
                <a class="page-link" th:href="@{|/mypage/${userId}?boardPage=0|}">
                    <span>처음</span>
                </a>
            </li>
            <li class="page-item" th:classappend="${not boardPage.hasPrevious()} ? 'disabled'">
                <a class="page-link" th:href="@{|/mypage/${userId}?boardPage=${boardPage.number - 1}|}">
                    <span>이전</span>
                </a>
            </li>
            <!-- 페이지 번호 표시 -->
            <li th:each="page : ${#numbers.sequence(0, boardPage.totalPages - 1)}"
                th:classappend="${boardPage.number == page} ? 'active'">
                <form th:action="@{|/mypage/${userId}|}" method="get">
                    <input type="hidden" name="boardPage" th:value="${page + 1}" />
                    <button type="submit" class="page-number" th:text="${page + 1}"></button>
                </form>
            </li>

            <li class="page-item" th:classappend="${not boardPage.hasNext()} ? 'disabled'">
                <a class="page-link" th:href="@{|/mypage/${userId}?boardPage=${boardPage.number + 1}|}">
                    <span>다음</span>
                </a>
            </li>
            <li class="page-item" th:classappend="${not boardPage.hasNext()} ? 'disabled'">
                <a class="page-link" th:href="@{|/mypage/${userId}?boardPage=${boardPage.totalPages - 1}|}">
                    <span>마지막</span>
                </a>
            </li>
        </ul>
    </div>

    <!-- 댓글 페이징 -->
    <h3>내가 작성한 댓글</h3>
    <table>
        <thead>
        <tr>
            <th>번호</th>
            <th>내용</th>
            <th>게시글</th>
            <th>생성 일시</th>
        </tr>
        </thead>
        <tbody>
        <!-- 댓글 행 반복 -->
        <tr th:each="comment, commentIndex : ${commentPage.content}">
            <td th:text="${commentIndex.index + 1}"></td>
            <td th:text="${comment.content}"></td>
            <td>
                <a th:href="@{/boards/{boardId}(boardId=${comment.board.id})}">게시글로 이동</a>
            </td>
            <td th:text="${#dates.format(comment.createdAt, 'yyyy-MM-dd HH:mm:ss')}"></td>
        </tr>
        </tbody>
    </table>

    <!-- 댓글 페이징 처리 -->
    <div th:if="${commentPage.totalPages > 0}">
        <ul class="pagination">
            <li class="page-item" th:classappend="${not commentPage.hasPrevious()} ? 'disabled'">
                <a class="page-link" th:href="@{|/mypage/${userId}?commentPage=0|}">
                    <span>처음</span>
                </a>
            </li>
            <li class="page-item" th:classappend="${not commentPage.hasPrevious()} ? 'disabled'">
                <a class="page-link" th:href="@{|/mypage/${userId}?commentPage=${commentPage.number - 1}|}">
                    <span>이전</span>
                </a>
            </li>
            <!-- 페이지 번호 표시 -->
            <li th:each="page : ${#numbers.sequence(0, commentPage.totalPages - 1)}"
                th:classappend="${commentPage.number == page} ? 'active'">
                <a class="page-number" th:href="@{|/mypage/${userId}?commentPage=${page}|}" th:text="${page + 1}"></a>
            </li>
            <li class="page-item" th:classappend="${not commentPage.hasNext()} ? 'disabled'">
                <a class="page-link" th:href="@{|/mypage/${userId}?commentPage=${commentPage.number + 1}|}">
                    <span>다음</span>
                </a>
            </li>
            <li class="page-item" th:classappend="${not commentPage.hasNext()} ? 'disabled'">
                <a class="page-link" th:href="@{|/mypage/${userId}?commentPage=${commentPage.totalPages - 1}|}">
                    <span>마지막</span>
                </a>
            </li>
        </ul>
    </div>
</div>
</body>
</html>
